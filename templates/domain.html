<!DOCTYPE html>
<html lang="en">
{{ $PageName := printf "%s - DNS CAA Catalog" .DomainResult.Domain }}
{{template "header" $PageName}}
<body>
    <header>
        <a href="/index.html" hx-get="/snippets/home.html" hx-target="#content" hx-push-url="/index.html"><h1>DNS CAA Catalog</h1></a>
    </header>
    <div class="container">
        <nav class="left-panel" hx-get="/snippets/nav.html" hx-trigger="load" hx-swap="innerHTML">
            <!-- Navigation will be loaded here via HTMX -->
        </nav>
        <main class="right-panel" id="content">
            {{.Content}}
        </main>
    </div>
    {{template "footer" .}}
    <script>
    // Function to apply all filters (search, CAA visibility, and record type filters)
    function applyFilters() {
        const searchInput = document.getElementById('searchInput');
        const hideMissingCaa = document.getElementById('hideMissingCaa');
        const links = document.querySelectorAll('.left-panel a');
        
        const filter = searchInput ? searchInput.value.toLowerCase() : '';
        const hideNoCaa = hideMissingCaa ? hideMissingCaa.checked : false;
        
        // Get active record type filters
        const activeFilters = [];
        const filterCheckboxes = document.querySelectorAll('.filter-container input[data-filter]');
        filterCheckboxes.forEach(function(checkbox) {
            if (checkbox.checked) {
                activeFilters.push(checkbox.getAttribute('data-filter'));
            }
        });
        
        links.forEach(function(link) {
            const matchesSearch = link.textContent.toLowerCase().includes(filter);
            const hasCaa = link.getAttribute('data-has-caa') === 'true';
            const showForCaa = !hideNoCaa || hasCaa;
            
            // Check record type filters (AND logic - must match ALL checked filters)
            let matchesRecordFilter = true;
            for (let i = 0; i < activeFilters.length; i++) {
                const filterType = activeFilters[i];
                if (link.getAttribute('data-has-' + filterType) !== 'true') {
                    matchesRecordFilter = false;
                    break;
                }
            }
            
            if (matchesSearch && showForCaa && matchesRecordFilter) {
                link.style.display = 'block';
            } else {
                link.style.display = 'none';
            }
        });
    }

    // Function to initialize search and filter functionality
    function initializeFilters() {
        const searchInput = document.getElementById('searchInput');
        const filterCheckboxes = document.querySelectorAll('.filter-container input[type="checkbox"]');
        
        if (searchInput) {
            searchInput.addEventListener('input', applyFilters);
        }
        
        filterCheckboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', applyFilters);
        });
        
        // Apply filters immediately to hide domains without CAA by default
        applyFilters();
    }

    // Initialize filters when navigation is loaded
    document.body.addEventListener('htmx:afterSwap', function(event) {
        if (event.target.classList.contains('left-panel')) {
            initializeFilters();
        }
    });

    // Also initialize on page load (fallback)
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initializeFilters, 100);
    });
    </script>
</body>
</html>
